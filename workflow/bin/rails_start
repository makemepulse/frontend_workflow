#!/usr/bin/env bash

CMD="cd frontend && npm run start"
SERVER=true

for param in "$@"
do

  if [ "$param" = "--no-server" ]
  then
    SERVER=false
  fi

  if [ "$param" = "--server" ]
  then
    SERVER=true
  fi

  if [[ "$param" =~ "--" ]]
  then
    CMD="$CMD"
  else
    CMD="cd frontend && npm run $param"
    SERVER=false
  fi

done

if [ $SERVER = true ]
then
  SPID=./tmp/pids/server.pid
  if [ -f "$SPID" ]
  then
    PID=$( cat ./tmp/pids/server.pid )
    kill $PID
  fi

  eval "rails s -b 0.0.0.0 & ( sleep 5 && $CMD )"
else
  eval $CMD
fi
